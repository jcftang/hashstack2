extends: [autotools_package]

dependencies:
  build: [gnu-sed, zlib]

sources:
- key: tar.gz:h5kghno6xe7p2kwe4i5cayjkdthtfgnf
  url: http://ftp.heanet.ie/pub/OpenBSD/LibreSSL/libressl-2.0.5.tar.gz

build_stages:

- name: configure
  when: platform == 'linux'
  extra: ['LDFLAGS=-lrt']

- name: configure
  when: platform == 'Darwin' and compiler == 'gcc'
  handler: bash
  bash: |
    echo "Failing for now as libressl requires clang on Darwin"

- files: [libressl-dummy-egd-functions.diff]
  name: patch
  handler: bash
  before: configure
  bash: |
    patch -p1 < _hashdist/libressl-dummy-egd-functions.diff

when_build_dependency:
- prepend_path: PATH
  value: '${ARTIFACT}/bin'
- prepend_path: PKG_CONFIG_PATH
  value: '${ARTIFACT}/lib/pkgconfig'
- {set: 'OPENSSL_DIR', value: "${ARTIFACT}" }
